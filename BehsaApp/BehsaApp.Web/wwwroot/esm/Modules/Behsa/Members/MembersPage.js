import{c as D,m as E,n as F,o as h,p as v}from"../../../_chunks/chunk-YWGKYAMU.js";import{a as l,b as M,c,d as y,f as I,g as k}from"../../../_chunks/chunk-HNONIMSC.js";var S=M((P,R)=>{R.exports=Serenity.Extensions});var x=c(k(),1);var g=c(I(),1),t=c(k(),1),N=c(S(),1);var w=c(I(),1);var p=class extends w.EntityDialog{constructor(){super(...arguments);this.form=new F(this.idPrefix)}getFormKey(){return F.formKey}getRowDefinition(){return h}getService(){return v.baseUrl}};l(p,"MembersDialog"),p=y([w.Decorators.registerClass("BehsaApp.Behsa.MembersDialog")],p);var b=h.Fields,m=class extends g.EntityGrid{constructor(e){super(e);this.pendingChanges={};this.slickContainer.on("change",".edit:input",n=>this.inputsChange(n))}getColumnsKey(){return E.columnsKey}getDialogType(){return p}getRowDefinition(){return h}getService(){return v.baseUrl}getButtons(){var e=super.getButtons();return e.push(N.ExcelExportHelper.createToolButton({grid:this,service:v.baseUrl+"/ListExcel",onViewSubmit:()=>this.onViewSubmit(),separator:!0})),e.push({title:"Save Changes",cssClass:"apply-changes-button disabled",onClick:n=>this.saveClick(),separator:!0}),e.push({title:"Download PDF",onClick:n=>alert("download pdf"),separator:!0}),e}onViewProcessData(e){return this.pendingChanges={},this.setSaveButtonState(),super.onViewProcessData(e)}numericInputFormatter(e){if(e.item.__nonDataRow)return(0,t.htmlEncode)((0,t.formatNumber)(e.value,"#0.##"));var n="edit numeric",a=e.item,i=this.pendingChanges[a.Id];i&&i[e.column.field]!==void 0&&(n+=" dirty");var r=this.getEffectiveValue(a,e.column.field);return"<input type='text' class='"+n+"' data-field='"+e.column.field+"' value='"+(0,t.formatNumber)(r,"0.##")+"'/>"}stringInputFormatter(e){if(e.item.__nonDataRow)return(0,t.htmlEncode)(e.value);var n="edit string",a=e.item,i=this.pendingChanges[a.Id],r=e.column;i&&i[r.field]!==void 0&&(n+=" dirty");var s=this.getEffectiveValue(a,r.field);return"<input type='text' class='"+n+"' data-field='"+r.field+"' value='"+(0,t.htmlEncode)(s)+"' maxlength='"+r.sourceItem.maxLength+"'/>"}selectFormatter(e,n,a){if(e.item.__nonDataRow)return(0,t.htmlEncode)(e.value);var i="edit",r=e.item,s=this.pendingChanges[r.Id],f=e.column;s&&s[n]!==void 0&&(i+=" dirty");var C=this.getEffectiveValue(r,n),u="<select class='"+i+"' data-field='"+n+"' style='width: 100%; max-width: 100%'><option value=''>--</option>";for(var o of a.items){let d=o[a.idField];u+="<option value='"+(0,t.htmlEncode)(d)+"'",d==C&&(u+=" selected"),u+=">"+(0,t.htmlEncode)(o[a.textField])+"</option>"}return u+"</select>"}getEffectiveValue(e,n){var a=this.pendingChanges[e.Id];return a&&a[n]!==void 0?a[n]:e[n]}getColumns(){var e=super.getColumns(),n=l(r=>this.numericInputFormatter(r),"num"),a=l(r=>this.stringInputFormatter(r),"str");(0,t.first)(e,r=>r.field==="FirstName").format=a;var i=(0,t.first)(e,r=>r.field===b.CityName);return i.referencedFields=[b.CityId],i.format=r=>this.selectFormatter(r,b.CityId,D.getLookup()),(0,t.first)(e,r=>r.field===b.LastName).format=a,e}inputsChange(e){var n=this.slickGrid.getCellFromEvent(e),a=this.itemAt(n.row),i=$(e.target),r=i.data("field"),s=(0,t.trimToNull)(i.val()),f=this.pendingChanges[a.Id],C=this.getEffectiveValue(a,r),u;i.hasClass("numeric")?u=(0,t.formatNumber)(C,"0.##"):u=C;var o;if(r==="FirstName")o=s,console.log("firstName value changed:",o);else if(i.hasClass("numeric")){var d=(0,t.parseInteger)(s!=null?s:"");if(isNaN(d)||d>32767||d<0){(0,t.notifyError)((0,t.localText)("Validation.Integer"),"",null),i.val(u),i.focus();return}o=d}else i.is("select")?o=(0,t.toId)(i.val()):o=s;f||(this.pendingChanges[a.Id]=f={}),f[r]=o,a[r]=o,this.view.refresh(),i.hasClass("numeric")&&(o=(0,t.formatNumber)(o,"0.##")),i.val(o).addClass("dirty"),this.setSaveButtonState()}setSaveButtonState(){this.toolbar.findButton("apply-changes-button").toggleClass("disabled",Object.keys(this.pendingChanges).length===0)}saveClick(){if(Object.keys(this.pendingChanges).length!==0){var e=Object.keys(this.pendingChanges),n=-1,a=this;l(function i(){if(++n>=e.length){a.refresh();return}var r=e[n],s=(0,t.deepClone)(a.pendingChanges[r]);s.Id=r,(0,t.serviceRequest)(v.Methods.Update,{EntityId:r,Entity:s},f=>{delete a.pendingChanges[r],i()})},"saveNext")()}}getQuickFilters(){var e=super.getQuickFilters(),n=(0,t.parseQueryString)();if(n.city){var a=(0,t.tryFirst)(e,i=>i.field=="CityId");a.init=i=>{i.element.getWidget(g.LookupEditor).value=n.city}}return e}};l(m,"MembersGrid"),m=y([g.Decorators.registerClass("BehsaApp.Behsa.MembersGrid")],m);function L(){(0,x.initFullHeightGridPage)(new m($("#GridDiv")).element)}l(L,"pageInit");export{L as default};
//# sourceMappingURL=MembersPage.js.map
